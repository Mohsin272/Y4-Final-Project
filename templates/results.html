{% extends "base.html" %} {% block body %}
<style>
  body {
    background: linear-gradient(to bottom, #89ffde 0%, #8f4bff 100%) no-repeat
      fixed;
    background: url("{{url_for('static', filename='green.jpg')}}") no-repeat
      center center fixed;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
    position: relative;
  }

  .card-title {
    margin-bottom: 0;
  }
  .traffic-light {
  width: 75px;
  height: 30px;
  background-color: black;
  border-radius: 10px;
  display: flex;
  flex-direction: row;
  justify-content: space-around;
  align-items: center;
}

.light {
  width: 20px;
  height: 20px;
  border-radius: 50%;
}

.red {
  background-color: red;
}

.green {
  background-color: #00FF00;
}

.activelightred {
  background-color: red;
  box-shadow: 0px 0px 5px #ff0, 0px 0px 10px red, 0px 0px 15px red;
  animation: flashRed 0.5s infinite;
}

.activelightgreen {
  background-color: #00FF00;
  box-shadow: 0px 0px 5px #ff0, 0px 0px 10px #0f0, 0px 0px 15px #0f0;
  animation: flashGreen 0.5s infinite;
}

@keyframes flashRed {
  0% {
    box-shadow: 0px 0px 5px #ff0, 0px 0px 10px red, 0px 0px 15px red;
  }
  50% {
    box-shadow: 0px 0px 10px #f00, 0px 0px 15px #f00, 0px 0px 20px #f00;
  }
  100% {
    box-shadow: 0px 0px 5px #ff0, 0px 0px 10px red, 0px 0px 15px red;
  }
}

@keyframes flashGreen {
  0% {
    box-shadow: 0px 0px 5px #ff0, 0px 0px 10px #0f0, 0px 0px 15px #0f0;
  }
  50% {
    box-shadow: 0px 0px 10px #0f0, 0px 0px 15px #0f0, 0px 0px 20px #0f0;
  }
  100% {
    box-shadow: 0px 0px 5px #ff0, 0px 0px 10px #0f0, 0px 0px 15px #0f0;
  }
}

</style>
{% if not data%}
<p class="text-center">Sorry no recipes found with your inputted ingredients</p>
{% else %}
<div class="d-flex flex-wrap justify-content-evenly">
  {% for row in data %}
  {% set val = cfv[loop.index0] if cfv else None %}
  <div class="position-relative border-0 card mb-5" style="width: 17rem">
    <img
      class="img-thumbnail"
      src="{{ row['recipe']['image'] }}"
      alt="Card image cap"
    />
    <div class="col-md-8">
      <div class="card-body">
        <h5 class="card-title">{{row['recipe']['label']}}</h5>
        {% if val %}
        <h6>Carbon Footprint Indicator</h6>
        <div class="traffic-light">
          {% if val == 'GREEN' %}
            <div class="light red"></div>
            <div class="light green activelightgreen"></div>
          {% endif %}             
          {% if val == 'RED' %}
            <div class="light red activelightred"></div>
            <div class="light green"></div>
          {% endif %} 
        </div>
        {% endif %}
        <!-- {% if cfv %}
          {% set val = cfv[0] %}
          <h6>Carbon Footprint Indicator</h6>
          <div class="traffic-light">
            {% if val == 'GREEN' %}
              <div class="light red"></div>
              <div class="light green activelightgreen"></div>
            {% endif %}             
            {% if val == 'RED' %}
              <div class="light red activelightred"></div>
              <div class="light green"></div>
            {% endif %} 
          </div>
        {% endif %} -->
      </div>
    </div>
    
    
    <button
      type="button"
      class="btn btn-dark"
      data-toggle="modal"
      data-target="#itemModal-{{ loop.index }}"
    >
      Click for More Info
    </button>

    <!-- Modal -->
    <div
      class="modal fade"
      id="itemModal-{{ loop.index }}"
      tabindex="-1"
      role="dialog"
      aria-labelledby="itemModalLabel-{{ loop.index }}"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="itemModalLabel-{{ loop.index }}">
              {{ row['recipe']['label'] }}
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <b>Ingredients:</b>
            {% for row in row['recipe']['ingredientLines'] %}
            <br />
            {{row}} {% endfor %}
            <br />
            <hr />
            <b>Serving Size:</b> {{(row['recipe']['yield'])|int }}
            <br />
            <b>Calories per person:</b> {{((row['recipe']['calories'])|int /
            (row['recipe']['yield'])|int) |int }}
            <br />
            <hr />
            <b>Nutritional Breakdown per serving:</b>
            <br />
            {{row['recipe']['totalNutrients']['CHOCDF.net']['label']}}
            {{((row['recipe']['totalNutrients']['CHOCDF.net']['quantity'])|int /
            (row['recipe']['yield'])|int)|int}}
            {{row['recipe']['totalNutrients']['CHOCDF.net']['unit']}}
            <br />
            {{row['recipe']['totalNutrients']['FAT']['label']}}
            {{((row['recipe']['totalNutrients']['FAT']['quantity'])|int /
            (row['recipe']['yield'])|int)|int}}
            {{row['recipe']['totalNutrients']['FAT']['unit']}}
            <br />
            {{row['recipe']['totalNutrients']['PROCNT']['label']}}
            {{((row['recipe']['totalNutrients']['PROCNT']['quantity'])|int /
            (row['recipe']['yield'])|int)|int}}
            {{row['recipe']['totalNutrients']['PROCNT']['unit']}}
            <br />
            {{row['recipe']['totalNutrients']['SUGAR']['label']}}
            {{((row['recipe']['totalNutrients']['SUGAR']['quantity'])|int /
            (row['recipe']['yield'])|int)|int}}
            {{row['recipe']['totalNutrients']['SUGAR']['unit']}}
            <br />
            {{row['recipe']['totalNutrients']['FIBTG']['label']}}
            {{((row['recipe']['totalNutrients']['FIBTG']['quantity'])|int /
            (row['recipe']['yield'])|int)|int}}
            {{row['recipe']['totalNutrients']['FIBTG']['unit']}}
            <hr />
            <a
              href="{{ row['recipe']['url'] }}"
              target="_blank"
              class="btn btn-outline-success"
              >Get Instructions</a
            >
            <form action="/addrecipe" method="post">
              <!--
              Hidden fields to hold all recipe information so it can be called by the save recipe function
            -->
              <input
              type="hidden"
              name="carbon"
              value="{{val}}"
              />
              <input
                type="hidden"
                name="Ingredients"
                value="{{row['recipe']['ingredientLines']}}"
              />
              <input
                type="hidden"
                name="Calories"
                value="{{((row['recipe']['calories'])|int / (row['recipe']['yield'])|int) |int }}"
              />
              <input
                type="hidden"
                name="Servings"
                value="{{(row['recipe']['yield'])|int }}"
              />
              <input
                type="hidden"
                name="Carbs name"
                value="{{row['recipe']['totalNutrients']['CHOCDF.net']['label']}}"
              />
              <input
                type="hidden"
                name="Carbs value"
                value=" {{((row['recipe']['totalNutrients']['CHOCDF.net']['quantity'])|int / (row['recipe']['yield'])|int)|int}}"
              />
              <input
                type="hidden"
                name="Carbs unit"
                value="{{row['recipe']['totalNutrients']['CHOCDF.net']['unit']}}"
              />
              <input
                type="hidden"
                name="Fat name"
                value="{{row['recipe']['totalNutrients']['FAT']['label']}}"
              />
              <input
                type="hidden"
                name="Fat value"
                value=" {{((row['recipe']['totalNutrients']['FAT']['quantity'])|int / (row['recipe']['yield'])|int)|int}}"
              />
              <input
                type="hidden"
                name="Fat unit"
                value="{{row['recipe']['totalNutrients']['FAT']['unit']}}"
              />
              <input
                type="hidden"
                name="Protein name"
                value="{{row['recipe']['totalNutrients']['PROCNT']['label']}}"
              />
              <input
                type="hidden"
                name="Protein value"
                value=" {{((row['recipe']['totalNutrients']['PROCNT']['quantity'])|int / (row['recipe']['yield'])|int)|int}}"
              />
              <input
                type="hidden"
                name="Protein unit"
                value="{{row['recipe']['totalNutrients']['PROCNT']['unit']}}"
              />
              <input
                type="hidden"
                name="Sugars name"
                value="{{row['recipe']['totalNutrients']['SUGAR']['label']}}"
              />
              <input
                type="hidden"
                name="Sugars value"
                value=" {{((row['recipe']['totalNutrients']['SUGAR']['quantity'])|int / (row['recipe']['yield'])|int)|int}}"
              />
              <input
                type="hidden"
                name="Sugars unit"
                value="{{row['recipe']['totalNutrients']['SUGAR']['unit']}}"
              />
              <input
                type="hidden"
                name="Fiber name"
                value="{{row['recipe']['totalNutrients']['FIBTG']['label']}}"
              />
              <input
                type="hidden"
                name="Fiber value"
                value=" {{((row['recipe']['totalNutrients']['FIBTG']['quantity'])|int / (row['recipe']['yield'])|int)|int}}"
              />
              <input
                type="hidden"
                name="Fiber unit"
                value="{{row['recipe']['totalNutrients']['FIBTG']['unit']}}"
              />
              <input
                type="hidden"
                name="Link"
                value="{{ row['recipe']['url'] }}"
              />
              <input
                type="hidden"
                name="Label"
                value="{{ row['recipe']['label'] }}"
              />
              <input
                type="hidden"
                name="Image"
                value="{{ row['recipe']['image'] }}"
              />
              {% if "username" not in session %}
              <button disabled type="submit" class="btn btn-outline-info">
                Save Recipe
              </button>
            {% else %}
              <button type="submit" class="btn btn-outline-info">
                Save Recipe
              </button>
            {% endif %}
            

              <!-- <button type="submit" class="btn btn-outline-info">
                Save Recipe
              </button> -->
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %} {% endif %}
</div>
{% endblock %}
